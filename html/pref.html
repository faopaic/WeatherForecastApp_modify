<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天気・気象予報</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .weather-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, auto);
            gap: 24px;
            width: 100%;
            min-height: 600px;
            box-sizing: border-box;
        }

        .weather-grid-item {
            background: #fff;
            border-radius: 14px;
            padding: 32px 32px;
            padding-top: 0px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            overflow-y: auto;
            margin-bottom: 0;
            min-width: 320px;
            max-width: 100%;
        }

        /* 全てのboxのタイトルと情報の間を狭くする */
        .weather-grid-item h2 {
            margin-bottom: 0px;
        }

        .weather-item {
            flex-direction: row !important;
            align-items: center !important;
            gap: 10px;
            display: flex;
            justify-content: flex-start;
        }

        .weather-item .date {
            min-width: unset;
            text-align: left;
        }

        .weather-item .wave,
        .weather-item .wind,
        .weather-item .pop,
        .weather-item .temp,
        .weather-item .weather {
            white-space: pre-line;
            text-align: left;
        }

        .weather-bottom-extra {
            margin-top: 16px !important;
            /* 注意報・警報ボックスの上に余白追加 */
        }

        .weather-grid-item.weather-bottom-extra,
        .weather-grid-item.weather-warning-top {
            padding-top: 8px !important;
        }

        @media (max-width: 1200px) {
            .container {
                max-width: 98vw;
                padding: 12px 0 32px 0;
            }

            .weather-grid {
                grid-template-columns: 1fr;
                grid-template-rows: none;
                gap: 18px;
            }

            .weather-grid-item {
                padding: 14px 4vw;
                min-width: unset;
            }
        }

        @media (max-width: 1900px) {
            .weather-grid {
                grid-template-columns: 1fr;
                grid-template-rows: none;
            }

            .weather-grid-item {
                margin-bottom: 16px;
            }
        }

        .container {
            max-width: 1550px;
            margin: 0 auto;
            padding: 4px 16px 16px 16px;
        }

        /* ライブカメラBoxのタイトルと映像の間を狭くする */
        .weather-livecam h2 {
            margin-bottom: 6px;
        }

        .weather-livecam iframe {
            margin-top: 0;
        }

        .weather-top-left {
            grid-row: 1;
            grid-column: 1;
        }

        .weather-top-center {
            grid-row: 1;
            grid-column: 2;
        }

        .weather-top-right {
            grid-row: 1;
            grid-column: 3;
        }

        .weather-bottom-left {
            grid-row: 2;
            grid-column: 1;
        }

        .weather-bottom-center {
            grid-row: 2;
            grid-column: 2;
        }

        .weather-bottom-right {
            grid-row: 2;
            grid-column: 3;
        }

        .weather-map-btn {
            min-width: 200px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 id="page-title">天気・気象予報</h1>
        <div id="weather-list"></div>
        <button onclick="history.back()">戻る</button>
    </div>
    <script>
        // 都道府県コードマップ
        const prefCodeMap = {
            hokkaido: { code: '016000', name: '北海道' },
            aomori: { code: '020000', name: '青森県' },
            iwate: { code: '030000', name: '岩手県' },
            miyagi: { code: '040000', name: '宮城県' },
            akita: { code: '050000', name: '秋田県' },
            yamagata: { code: '060000', name: '山形県' },
            fukushima: { code: '070000', name: '福島県' },
            ibaraki: { code: '080000', name: '茨城県' },
            tochigi: { code: '090000', name: '栃木県' },
            gunma: { code: '100000', name: '群馬県' },
            saitama: { code: '110000', name: '埼玉県' },
            chiba: { code: '120000', name: '千葉県' },
            tokyo: { code: '130000', name: '東京都' },
            kanagawa: { code: '140000', name: '神奈川県' },
            niigata: { code: '150000', name: '新潟県' },
            toyama: { code: '160000', name: '富山県' },
            ishikawa: { code: '170000', name: '石川県' },
            fukui: { code: '180000', name: '福井県' },
            yamanashi: { code: '190000', name: '山梨県' },
            nagano: { code: '200000', name: '長野県' },
            gifu: { code: '210000', name: '岐阜県' },
            shizuoka: { code: '220000', name: '静岡県' },
            aichi: { code: '230000', name: '愛知県' },
            mie: { code: '240000', name: '三重県' },
            shiga: { code: '250000', name: '滋賀県' },
            kyoto: { code: '260000', name: '京都府' },
            osaka: { code: '270000', name: '大阪府' },
            hyogo: { code: '280000', name: '兵庫県' },
            nara: { code: '290000', name: '奈良県' },
            wakayama: { code: '300000', name: '和歌山県' },
            tottori: { code: '310000', name: '鳥取県' },
            shimane: { code: '320000', name: '島根県' },
            okayama: { code: '330000', name: '岡山県' },
            hiroshima: { code: '340000', name: '広島県' },
            yamaguchi: { code: '350000', name: '山口県' },
            tokushima: { code: '360000', name: '徳島県' },
            kagawa: { code: '370000', name: '香川県' },
            ehime: { code: '380000', name: '愛媛県' },
            kochi: { code: '390000', name: '高知県' },
            fukuoka: { code: '400000', name: '福岡県' },
            saga: { code: '410000', name: '佐賀県' },
            nagasaki: { code: '420000', name: '長崎県' },
            kumamoto: { code: '430000', name: '熊本県' },
            oita: { code: '440000', name: '大分県' },
            miyazaki: { code: '450000', name: '宮崎県' },
            kagoshima: { code: '460100', name: '鹿児島県' },
            okinawa: { code: '471000', name: '沖縄県' }
        };
        // URLパラメータから都道府県ID取得
        const params = new URLSearchParams(location.search);
        const prefId = params.get('pref');
        const pref = prefCodeMap[prefId];
        if (!pref) {
            document.getElementById('page-title').textContent = '都道府県が指定されていません';
        } else {
            document.getElementById('page-title').textContent = `${pref.name}の天気・気象予報`;
            fetch(`https://www.jma.go.jp/bosai/forecast/data/forecast/${pref.code}.json`)
                .then(res => res.json())
                .then(data => {
                    console.log('取得データ', data); // デバッグ用
                    let html = '';
                    html += `<div class=\"weather-grid\">`;

                    // --- 天気（左上） ---
                    html += `<div class=\"weather-grid-item weather-top-left\"><h2>天気</h2>`;
                    let weatherSeries = null;
                    for (const s of data[0].timeSeries) {
                        if (s.areas && s.areas.some(a => Array.isArray(a.weathers) && a.weathers.length > 0)) {
                            weatherSeries = s;
                            break;
                        }
                    }
                    if (weatherSeries) {
                        weatherSeries.areas.forEach(area => {
                            if (!Array.isArray(area.weathers) || area.weathers.length === 0) return;
                            html += `<div class=\"area-name\">${area.area.name}</div>`;
                            for (let i = 0; i < weatherSeries.timeDefines.length; i++) {
                                const date = new Date(weatherSeries.timeDefines[i]);
                                const y = date.getFullYear();
                                const m = date.getMonth() + 1;
                                const d = date.getDate();
                                let weatherText = area.weathers[i] ?? 'データなし';
                                // 部分色分け
                                let coloredText = weatherText
                                    .replace(/晴れ/g, '<span style="color:#ffbe4d;font-weight:bold;text-shadow:0 0 2px #000,1px 1px 0 #000,-1px -1px 0 #000;">晴れ</span>')
                                    .replace(/くもり|曇/g, '<span style="color:#b3b3b3;font-weight:bold;text-shadow:0 0 2px #000,1px 1px 0 #000,-1px -1px 0 #000;">$&</span>')
                                    .replace(/雨/g, '<span style="color:#80bfff;font-weight:bold;text-shadow:0 0 2px #000,1px 1px 0 #000,-1px -1px 0 #000;">雨</span>')
                                    .replace(/雷/g, '<span style="color:#ffff66;font-weight:bold;text-shadow:0 0 2px #000,1px 1px 0 #000,-1px -1px 0 #000;">雷</span>')
                                    .replace(/雪/g, '<span style="color:#4fd7ff;font-weight:bold;text-shadow:0 0 2px #000,1px 1px 0 #000,-1px -1px 0 #000;">雪</span>');
                                // 余白を徹底的に調整（:の直後のspan要素の前後のスペースも削除）
                                html += `<div class=\"weather-item\"><span class=\"date\" style=\"white-space:nowrap;\">${y}年${m}月${d}日：</span><span class=\"weather\" style=\"color:#fff;text-shadow:0 0 2px #000,1px 1px 0 #000,-1px -1px 0 #000;\">${coloredText}</span></div>`;
                            }
                        });
                    } else {
                        html += `<div>天気データなし</div>`;
                    }
                    html += `</div>`;

                    // --- 気温（中央上部） ---
                    html += `<div class=\"weather-grid-item weather-top-center\"><h2>気温</h2>`;
                    let tempSeries = null;
                    for (const s of data[0].timeSeries) {
                        if (s.areas && s.areas.some(a => Array.isArray(a.temps) && a.temps.length > 0)) {
                            tempSeries = s;
                            break;
                        }
                    }
                    if (tempSeries) {
                        tempSeries.areas.forEach(area => {
                            if (!Array.isArray(area.temps) || area.temps.length === 0) return;
                            html += `<div class=\"area-name\">${area.area.name}</div>`;
                            // 2日分ごとに最低・最高をセットで表示
                            for (let i = 0; i < tempSeries.timeDefines.length; i += 2) {
                                const date = new Date(tempSeries.timeDefines[i]);
                                const y = date.getFullYear();
                                const m = date.getMonth() + 1;
                                const d = date.getDate();
                                const min = area.temps[i];
                                const max = area.temps[i + 1];
                                // 最低気温
                                if (min !== undefined) {
                                    const minDisplay = (min !== undefined && max !== undefined && min === max) ? '-' : `${min}℃`;
                                    html += `<div class=\"weather-item\" style=\"background:#eaf4fb;\"><b>${y}年${m}月${d}日：</b><span class=\"temp\">${minDisplay}</span> <span style=\"color:#007acc;\">（最低）</span></div>`;
                                }
                                // 最高気温
                                if (max !== undefined) {
                                    html += `<div class=\"weather-item\" style=\"background:#eaf4fb;\"><b>${y}年${m}月${d}日：</b><span class=\"temp\">${max}℃</span> <span style=\"color:#e67e22;\">（最高）</span></div>`;
                                }
                            }
                        });
                    } else {
                        html += `<div>気温データなし</div>`;
                    }
                    html += `</div>`;

                    // --- ライブカメラ（右上） ---
                    html += `<div class=\"weather-grid-item weather-top-right weather-livecam\"><h2>ライブカメラ</h2>`;
                    if (prefId === 'hokkaido') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/38rSYDm-yTk?si=XQqOOTsMbC2WQZYJ\" title=\"北海道ライブカメラ\" frameborder=\"0\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">北海道ライブカメラ</div></div>`;
                    } else if (prefId === 'aomori') {
                        html += `<div id=\"aomori-livecam\" style=\"text-align:center;\">読み込み中...</div>`;
                    } else if (prefId === 'iwate') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/M1LNwnS3jeU?si=6Ek9okPCspXiRttR\" title=\"岩手ライブカメラ\" frameborder=\"0\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">岩手ライブカメラ</div></div>`;
                    } else if (prefId === 'miyagi') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/nczUqLlEXbE?si=4ruO-5z_t8yxjxw-\" title=\"宮城ライブカメラ\" frameborder=\"0\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">宮城ライブカメラ</div></div>`;
                    } else if (prefId === 'akita') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/J7_rWq_Owgc?si=gGmX75gzEN_pEdMp\" title=\"秋田ライブカメラ\" frameborder=\"0\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">秋田ライブカメラ</div></div>`;
                    } else if (prefId === 'yamagata') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/7xyUfh0hpe0?si=N3j5FR4-qoyxXx8U\" title=\"山形ライブカメラ\" frameborder=\"0\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">山形ライブカメラ</div></div>`;
                    } else if (prefId === 'fukushima') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/yoOGxenxnEU?si=aGQcDr_AztKXpKo_\" title=\"福島ライブカメラ\" frameborder=\"0\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">福島ライブカメラ</div></div>`;
                    } else if (prefId === 'ibaraki') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/_kNCRJ2Ray0?si=2_Bj3FrzrEEP1syg\" title=\"茨城ライブカメラ\" frameborder=\"0\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">茨城ライブカメラ</div></div>`;
                    } else if (prefId === 'tochigi') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/yujHR3zx0K0?si=Nu4ybKR3bce59uSf\" title=\"栃木ライブカメラ\" frameborder=\"0\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">栃木ライブカメラ</div></div>`;
                    } else if (prefId === 'gunma') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/_1PfF1v9GJc?si=x7pxuayUS8ppC4Gs\" title=\"群馬ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">群馬ライブカメラ</div></div>`;
                    } else if (prefId === 'saitama') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/r4KArqPEaTM?si=8Ngf5am2qJmXYS8A\" title=\"埼玉ライブカメラ\" frameborder=\"0\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">埼玉ライブカメラ</div></div>`;
                    } else if (prefId === 'chiba') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/q1Nxn99NwJ4?si=IOZnMFPvUCFJYTEd\" title=\"千葉ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">千葉ライブカメラ</div></div>`;
                    } else if (prefId === 'tokyo') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/Dbvqk7d3G2s?si=Nzgg63BEanIzMgR2\" title=\"東京ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">東京ライブカメラ</div></div>`;
                    } else if (prefId === 'kanagawa') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/GDtHtiQs37A?si=O9vywaTZvbGwfGPq\" title=\"神奈川ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">神奈川ライブカメラ</div></div>`;
                    } else if (prefId === 'niigata') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/mwTyv5WRFtc?si=DR_0MR2pyxl_zh_j\" title=\"新潟ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">新潟ライブカメラ</div></div>`;
                    } else if (prefId === 'toyama') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/rCXqDE9G53A?si=FOqAuHFiTLG7fzdo\" title=\"富山ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">富山ライブカメラ</div></div>`;
                    } else if (prefId === 'ishikawa') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/rXwJr5g3rzI?si=8DH2Wjv7fGtDyjyI\" title=\"石川ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">石川ライブカメラ</div></div>`;
                    } else if (prefId === 'fukui') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/IrXQ8JID0Gs?si=wTc9wYXO-Gn7YQKq\" title=\"福井ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">福井ライブカメラ</div></div>`;
                    } else if (prefId === 'yamanashi') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/0KMeH_vh0Bk?si=eXN4xjzZt8edYTiu\" title=\"山梨ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">山梨ライブカメラ</div></div>`;
                    } else if (prefId === 'nagano') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/SOt3wKdf7KM?si=0_yDTllPASPZPNf-\" title=\"長野ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">長野ライブカメラ</div></div>`;
                    } else if (prefId === 'gifu') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/flf9eK5PREQ?si=1v1bpzR9UHXTT4ri\" title=\"岐阜ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">岐阜ライブカメラ</div></div>`;
                    } else if (prefId === 'shizuoka') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/8cmSSAXudbI?si=DIOF6hXL-ZShuRc9\" title=\"静岡ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">静岡ライブカメラ</div></div>`;
                    } else if (prefId === 'aichi') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/khi056RTSlM?si=OrwAdka8wZHLp9JV\" title=\"愛知ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">愛知ライブカメラ</div></div>`;
                    } else if (prefId === 'mie') {
                        html += `<div style=\"text-align:center;\"><img id=\"mie-livecam-img\" src=\"https://livecamera.ict.jp/cgi-bin/Get.cgi?a=42202551014209&n=29\" width=\"560\" alt=\"国道163号線（丸之内交差点）ライブカメラ\"><div style=\"font-size:0.9em;margin-top:4px;\">伊賀市 国道163号線（丸之内交差点）ライブカメラ（静止画自動更新）</div></div>`;
                    } else if (prefId === 'shiga') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/Po_2aQkC07U?si=aCRLcn5BdH1DlViZ\" title=\"滋賀ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">滋賀ライブカメラ</div></div>`;
                    } else if (prefId === 'kyoto') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/v9rQqa_VTEY?si=1qEkmGuSW9Rynzc4\" title=\"京都ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">京都ライブカメラ</div></div>`;
                    } else if (prefId === 'osaka') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/mrCtoiKzBxo?si=VIj2_12Z_re9LnA7\" title=\"大阪ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">大阪ライブカメラ</div></div>`;
                    } else if (prefId === 'hyogo') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/8tDuhb9QnQ4?si=YK7bgFJsbIPc6W0N\" title=\"兵庫ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">兵庫ライブカメラ</div></div>`;
                    } else if (prefId === 'nara') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/VDPBmrAEWMw?si=7d_xMprTAinZ31_k\" title=\"奈良ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">奈良ライブカメラ</div></div>`;
                    } else if (prefId === 'wakayama') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/DyBIT8goWDo?si=RHFo8xxF0WOGSjcn\" title=\"和歌山ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">和歌山ライブカメラ</div></div>`;
                    } else if (prefId === 'tottori') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/TMMhsnjVNG0?si=lDRLRZA_ykhclgJk\" title=\"鳥取ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">鳥取ライブカメラ</div></div>`;
                    } else if (prefId === 'shimane') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/gCSr3Qm3BDM?si=Qy9aKdqYMhpJOF0G\" title=\"島根ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">島根ライブカメラ</div></div>`;
                    } else if (prefId === 'okayama') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/kpEd-FgkhKA?si=outG7Rj-UwnTGiza\" title=\"岡山ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">岡山ライブカメラ</div></div>`;
                    } else if (prefId === 'hiroshima') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/bVFs9L6GLV0?si=J6pqqP6ukvHsqXhU\" title=\"広島ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">広島ライブカメラ</div></div>`;
                    } else if (prefId === 'yamaguchi') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/bU8gyGy8uCY?si=f5AkPXFBhT7KzUNN\" title=\"山口ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">山口ライブカメラ</div></div>`;
                    } else if (prefId === 'tokushima') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/Dbvqk7d3G2s?si=Nzgg63BEanIzMgR2\" title=\"徳島ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">徳島ライブカメラ</div></div>`;
                    } else if (prefId === 'kagawa') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/PTy6ofjU_q8?si=gD_IyIqkxH4HuUSV\" title=\"香川ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">香川ライブカメラ</div></div>`;
                    } else if (prefId === 'ehime') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/aJcTvBuj5AA?si=XGXktp5vmPAzfJLH\" title=\"愛媛ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">愛媛ライブカメラ</div></div>`;
                    } else if (prefId === 'kochi') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/bLbpMFbYw0Q?si=H8b-uZ5QN4DEPR8h\" title=\"高知ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">高知ライブカメラ</div></div>`;
                    } else if (prefId === 'fukuoka') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/3D1NIpeZyBg?si=0-zCT72NPweBIXMZ\" title=\"福岡ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">福岡ライブカメラ</div></div>`;
                    } else if (prefId === 'saga') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/OOn0sJuEbSA?si=gBabr5ug9SA64lHE\" title=\"佐賀ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">佐賀ライブカメラ</div></div>`;
                    } else if (prefId === 'nagasaki') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/ZoETGE0w5w8?si=UBsgHFko6yk0BIrD\" title=\"長崎ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">長崎ライブカメラ</div></div>`;
                    } else if (prefId === 'kumamoto') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/Mfq_QtuyrYI?si=tq-ToXoeyriy-cQ9\" title=\"熊本ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">熊本ライブカメラ</div></div>`;
                    } else if (prefId === 'oita') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/b2AU2EL4BW0?si=QCBC6a2zFnCBgFGL\" title=\"大分ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">大分ライブカメラ</div></div>`;
                    } else if (prefId === 'miyazaki') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/T3uOuFisD4A?si=aYnXXmraraJpdZKD\" title=\"宮崎ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">宮崎ライブカメラ</div></div>`;
                    } else if (prefId === 'kagoshima') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/Fw9K-zkkNhs?si=qJ1YRJ_CiAm1p95i\" title=\"鹿児島ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">鹿児島ライブカメラ</div></div>`;
                    } else if (prefId === 'okinawa') {
                        html += `<div style=\"text-align:center;\"><iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/6HYjCFkmDPA?si=owHEaH1n4v1rybdj\" title=\"沖縄ライブカメラ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">沖縄ライブカメラ</div></div>`;
                    } else {
                        html += `<div style=\"text-align:center;\">対応するライブカメラがありません</div>`;
                    }
                    html += `</div>`; // weather-livecam

                    // グリッドの一番最後（ライブカメラboxの直後、4列目の空きスペース）に都道府県マップボタンを追加
                    // html += `<div class=\"weather-grid-item weather-map-btn\" style=\"display:flex;align-items:center;justify-content:center;min-width:200px;\"><button onclick=\"location.href='japanmap.html'\" style=\"padding:18px 32px;font-size:1.2em;border-radius:10px;background:#007acc;color:#fff;border:none;cursor:pointer;box-shadow:0 2px 8px #007acc44;font-weight:bold;letter-spacing:0.1em;\">都道府県マップへ</button></div>`;

                    // --- 降水確率（左下） ---
                    html += `<div class=\"weather-grid-item weather-bottom-left\"><h2>降水確率</h2>`;
                    let popSeries = null;
                    for (const s of data[0].timeSeries) {
                        if (s.areas && s.areas.some(a => Array.isArray(a.pops) && a.pops.length > 0)) {
                            popSeries = s;
                            break;
                        }
                    }
                    if (popSeries) {
                        popSeries.areas.forEach(area => {
                            if (!Array.isArray(area.pops) || area.pops.length === 0) return;
                            html += `<div class=\"area-name\">${area.area.name}</div>`;
                            // 日付ごとに降水確率をまとめて表示
                            const dateMap = {};
                            for (let i = 0; i < popSeries.timeDefines.length; i++) {
                                const date = new Date(popSeries.timeDefines[i]);
                                const y = date.getFullYear();
                                const m = date.getMonth() + 1;
                                const d = date.getDate();
                                const key = `${y}年${m}月${d}日`;
                                if (!dateMap[key]) dateMap[key] = [];
                                dateMap[key].push((area.pops[i] ?? '-') + '%');
                            }
                            Object.keys(dateMap).forEach(key => {
                                const pops = dateMap[key].join(' / ');
                                // 降水確率 日付と:の間に半角スペースを1つ入れる（:の後に余計なスペースが入らないよう修正）
                                html += `<div class=\"weather-item\"><span class=\"date\" style=\"white-space:nowrap;\">${key}：</span><span class=\"pop\">${pops}</span></div>`;
                            });
                        });
                    } else {
                        html += `<div>降水確率データなし</div>`;
                    }
                    html += `</div>`;

                    // --- 波・風（中央下部） ---
                    html += `<div class=\"weather-grid-item weather-bottom-center\"><h2>波・風</h2>`;
                    let waveSeries = null,
                        windSeries = null;
                    for (const s of data[0].timeSeries) {
                        if (!waveSeries && s.areas && s.areas.some(a => Array.isArray(a.waves) && a.waves.length > 0)) {
                            waveSeries = s;
                        }
                        if (!windSeries && s.areas && s.areas.some(a => Array.isArray(a.winds) && a.winds.length > 0)) {
                            windSeries = s;
                        }
                    }
                    if (waveSeries || windSeries) {
                        // area.nameのリストを作成（波・風両方に存在するareaを優先、なければどちらかにあるareaも表示）
                        const areaNames = new Set();
                        if (waveSeries) waveSeries.areas.forEach(a => areaNames.add(a.area.name));
                        if (windSeries) windSeries.areas.forEach(a => areaNames.add(a.area.name));
                        areaNames.forEach(areaName => {
                            html += `<div class=\"area-name\">${areaName}</div>`;
                            // 該当areaを取得
                            const waveArea = waveSeries ? waveSeries.areas.find(a => a.area.name === areaName) : null;
                            const windArea = windSeries ? windSeries.areas.find(a => a.area.name === areaName) : null;
                            // 日付リスト（波・風どちらか長い方に合わせる）
                            const timeDefines = (waveSeries && waveArea ? waveSeries.timeDefines : (windSeries && windArea ? windSeries.timeDefines : []));
                            for (let i = 0; i < timeDefines.length; i++) {
                                const date = new Date(timeDefines[i]);
                                const y = date.getFullYear();
                                const m = date.getMonth() + 1;
                                const d = date.getDate();
                                // 波
                                let waveValue = waveArea && Array.isArray(waveArea.waves) ? (waveArea.waves[i] ?? 'データなし') : 'データなし';
                                waveValue = waveValue.replace(/[０-９．－]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0));
                                waveValue = waveValue.replace(/(メートル|ﾒｰﾄﾙ|ｍ|m)/gi, '').trim();
                                if (waveValue !== 'データなし' && waveValue !== '') {
                                    // 各数値部分ごとにmを付与
                                    waveValue = waveValue.replace(/([0-9]+\.?[0-9]*)/g, '$1m');
                                }
                                // 風
                                let windValue = windArea && Array.isArray(windArea.winds) ? (windArea.winds[i] ?? 'データなし') : 'データなし';
                                // 全角スペースを半角スペースに変換
                                waveValue = waveValue.replace(/　/g, ' ');
                                windValue = windValue.replace(/　/g, ' ');
                                // 波・風の区切りを「／」から「|<br>|<br>|<br>」に変更
                                // padFixed関数を使わず、そのまま値を表示
                                html += `<div class=\"weather-item\"><span class=\"date\" style=\"white-space:nowrap;\">${y}年${m}月${d}日：</span><span class=\"wave\">${waveValue}</span> |<br>|<br>|<br><span class=\"wind\">${windValue}</span></div>`;
                            }
                        });
                    } else {
                        html += `<div>波・風データなし</div>`;
                    }
                    html += `</div>`; // weather-bottom-center

                    // --- 都道府県マップ（右下） ---
                    html += `<div class=\"weather-grid-item weather-bottom-right weather-map-btn\" style=\"display:flex;align-items:center;justify-content:center;min-width:200px;\"><button onclick=\"location.href='heatmap.html'\" style=\"padding:18px 32px;font-size:1.2em;border-radius:10px;background:#007acc;color:#fff;border:none;cursor:pointer;box-shadow:0 2px 8px #007acc44;font-weight:bold;letter-spacing:0.1em;\">都道府県ヒートマップへ</button></div>`;

                    // --- 注意報・警報 ---
                    // ここは何も出力しない（fetchで必要な場合のみ追加）
                    html += `</div>`; // weather-grid
                    // グリッドの直後に都道府県マップボタンを追加
                    // 概況や詳細情報
                    if (data[0].text) {
                        for (const key in data[0].text) {
                            html += `<div class=\"series-block\"><h2>${key}</h2><div>${data[0].text[key]}</div></div>`;
                        }
                    }
                    document.getElementById('weather-list').innerHTML = html;

                    let warningHtml = '';
                    // 注意報・警報データ取得＆表示
                    fetch(`https://www.jma.go.jp/bosai/warning/data/warning/${pref.code}.json`)
                        .then(res => res.json())
                        .then(warningData => {
                            if (warningData && warningData.headlineText) {
                                const text = warningData.headlineText.trim();
                                if (
                                    text !== '' &&
                                    text !== '注意報を解除します。' &&
                                    text !== '警報・注意報は発表されていません' &&
                                    text !== '警報・注意報はありません'
                                ) {
                                    // 警報・注意報の内容に応じてgifを表示
                                    let boxBgStyle = '';
                                    let warnTextStyle = '';
                                    if (text.includes('風')) {
                                        boxBgStyle = 'background-image:url(\'img/treewind.gif\');background-size:100% 100%;background-repeat:no-repeat;background-position:center center;';
                                        warnTextStyle = 'color:#fff;text-shadow:0 0 4px #000,0 0 8px #000;';
                                    } else if (text.includes('雨')) {
                                        boxBgStyle = 'background-image:url(\'img/rainy1.gif\');background-size:100% 100%;background-repeat:no-repeat;background-position:center center;';
                                        warnTextStyle = 'color:#fff;text-shadow:0 0 4px #000,0 0 8px #000;';
                                    } else if (text.includes('雷')) {
                                        boxBgStyle = 'background-image:url(\'img/raiu.gif\');background-size:100% 100%;background-repeat:no-repeat;background-position:center center;';
                                        boxBgStyle = 'background-image:url(\'img/giphy.gif\');background-size:100% 100%;background-repeat:no-repeat;background-position:center center;';
                                        warnTextStyle = 'color:#fff;text-shadow:0 0 4px #000,0 0 8px #000;';
                                    }
                                    warningHtml = `<div class=\"weather-grid-item weather-bottom-extra weather-warning-top\" style=\"${boxBgStyle}\"><h2 style="color:yellow" ;>注意報・警報</h2><div id=\"warn-area\"><div class=\"warn-headline\" style=\"${warnTextStyle}\">${text}</div></div></div>`;
                                }
                            }
                            // 注意報・警報を先頭に、その後に天気グリッドを表示
                            document.getElementById('weather-list').innerHTML = warningHtml + html;
                        })
                        .catch(() => {
                            document.getElementById('weather-list').innerHTML = html;
                        });
                })
                .catch((err) => {
                    document.getElementById('weather-list').textContent = '天気予報データの取得に失敗しました。';
                    console.error('天気予報データ取得エラー', err);
                });
        }

        // --- 青森県ライブカメラAPI取得 ---
        if (prefId === 'aomori') {
            const apiKey = 'AIzaSyB4IY4F5lHAdo6lXUJ9-Z2fd0bmsQuF7FI';
            const channelId = 'UCdNYphHZdRYjpys_gwofUNQ';
            const apiUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&eventType=live&type=video&key=${apiKey}`;
            fetch(apiUrl)
                .then(res => res.json())
                .then(data => {
                    const liveDiv = document.getElementById('aomori-livecam');
                    if (data.items && data.items.length > 0) {
                        const videoId = data.items[0].id.videoId;
                        liveDiv.innerHTML = `<iframe width=\"480\" height=\"270\" src=\"https://www.youtube.com/embed/${videoId}?autoplay=1\" title=\"青森ライブカメラ\" frameborder=\"0\" allowfullscreen></iframe><div style=\"font-size:0.9em;margin-top:4px;\">青森ライブカメラ（ライブ配信中）</div>`;
                    } else {
                        liveDiv.innerHTML = `<div style=\"color:#888;\">現在ライブ配信中の動画がありません</div>`;
                    }
                })
                .catch(err => {
                    const liveDiv = document.getElementById('aomori-livecam');
                    liveDiv.innerHTML = `<div style=\"color:#888;\">ライブカメラ情報の取得に失敗しました</div>`;
                });
        }
        // --- 三重県ライブカメラ自動更新 ---
        if (prefId === 'mie') {
            const updateImg = () => {
                const img = document.getElementById('mie-livecam-img');
                if (img) {
                    const base = 'https://livecamera.ict.jp/cgi-bin/Get.cgi?a=42202551014209&n=29';
                    img.src = base + '&_t=' + Date.now();
                }
            };
            updateImg();
            setInterval(updateImg, 3000); // 3秒ごとに更新
        }

        // すべてのライブカメラiframeのwidthとheightをwidth="480" height="270"に統一
        html = html.replace(/<iframe width=\\?"\d+\\?" height=\\?"\d+\\?"/g, '<iframe width="480" height="270"');
    </script>
</body>

</html>